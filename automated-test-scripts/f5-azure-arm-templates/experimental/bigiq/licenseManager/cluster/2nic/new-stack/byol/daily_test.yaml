---
name: Azure <CLUSTER FOLDER> <NIC COUNT>NIC-BIGIQ-LICMGMT <LICENSE TYPE> <INSTANCE TYPE> <REGION> <BRANCH>
onStart:
- ../../../../../../../common/create_resource_group.sh
- ../../../../../../../common/create_environment.sh
- ../../../../../../../../sleep/3_minutes.sh
- ../../../../../../../common/verify_create_env.sh
- ../../../../../../../common/create_bigiq_deployment.sh
- ../../../../../../../../sleep/5_minutes.sh
- ../../../../../../../common/verify_create.sh
- ../../../../../../../../sleep/10_minutes.sh
- ../../../../../../../common/verify_onboard_bigiq.sh
- ../../../../../../../common/verify_registration_key.sh
- ../../../../../../../common/verify_reg_pool_keys.sh
- ../../../../../../../common/verify_lic_pool_keys.sh
- ../../../../../../../common/verify_ntp.sh
- ../../../../../../../common/verify_time_zone.sh
- ../../../../../../../common/delete_deployment.sh
- ../../../../../../../../sleep/3_minutes.sh
- ../../../../../../../common/verify_delete.sh
onFail:
- ../../../../../../../common/capture_logs_bigiq.sh
- ../../../../../../../common/delete_deployment.sh
- ../../../../../../../common/verify_delete.sh
params:
- tag: BIGIQ VERSION
  values:
  - latest
  - 6.0.0001674
  - 6.0.100813
- tag: BRANCH
  values:
  - master
  - R19-1
  - ESECLDTPLT-888
- tag: ADMIN USER
  values:
  - dewpoint
- tag: INSTANCE TYPE
  values:
  - Standard_D4s_v3
  - Standard_D2s_v3
  - Standard_D8s_v3
- tag: INSTANCE NAME
  values:
  - f5bigiqvm
- tag: LICENSE PARAM
  values:
  - value: ',"bigIqLicenseKey1":{"value":"<AUTOFILL BIGIQ LICENSE KEY>"}'
- tag: LICENSE TYPE
  values:
  - byol
- tag: LICENSE POOL KEYS
  values:
  - License Pool
  - Do Not Create
- tag: LIC POOL PARAM
  values:
  - value: ',"licensePoolKeys":{"value":"TestLicPool1:<AUTOFILL CLPV2 LICENSE KEY>"}'
    when:
      tag: LICENSE POOL KEYS
      values:
      - License Pool
  - value: ',"licensePoolKeys":{"value":"Do_Not_Create"}'
    when:
      tag: LICENSE POOL KEYS
      values:
      - Do Not Create
- tag: REGISTRATION POOL KEYS
  values:
  - License Pool
  - Do Not Create
- tag: REG POOL PARAM
  values:
  - value: ',"regPoolKeys":{"value":"TestRegPool:<AUTOFILL EVAL LICENSE KEY>"}'
    when:
      tag: REGISTRATION POOL KEYS
      values:
      - License Pool
  - value: ',"regPoolKeys":{"value":"Do_Not_Create"}'
    when:
      tag: REGISTRATION POOL KEYS
      values:
      - Do Not Create
- tag: MGMT PIP1
  values:
  - mgmt-pip
- tag: MGMT PIP2
  values:
  - mgmt-pip1
- tag: NETWORK PARAM
  values:
  - value: ',"numberOfInternalIps":{"value":<INTERNAL IP COUNT>}'
    when:
      tag: CLUSTER
      values:
      - No
  - value: ''
    when:
      tag: CLUSTER
      values:
      - Yes
- tag: NIC COUNT
  values:
  - 2
- tag: TEMPLATE NAME
  values:
  - value: <NIC COUNT>nic
- tag: INTERNAL IP COUNT
  values:
  - 0
  - 1
- tag: NTP SERVER
  values:
  - 0.pool.ntp.org
- tag: REGION
  values:
  - eastus
  - westus
  - ukwest
  - eastus2
  - centralus
  - northcentralus
  - southcentralus
  - canadaeast
  - canadacentral
  - brazilsouth
  - uksouth
  - northeurope
  - westeurope
  - southindia
  - westindia
  - japaneast
  - westus2
  - australiaeast
  - australiasoutheast
- tag: CUSTOM IMAGE PARAM
  values:
  - value: OPTIONAL
  - value: CUSTOM
    # need to support multiple requires to only allow if license type is byol or bigiq
    requires:
      tag: REGION
      values:
      - westus
- tag: STACK TYPE SHORT
  values:
  - value: es
    when:
      tag: STACK TYPE
      values:
      - existing-stack
- tag: RESOURCE GROUP
  values:
  - dp-<STACK TYPE SHORT>-<LICENSE TYPE>-<NIC COUNT>n-<REGION>-<DEWPOINT JOB ID>
- tag: SSH PORT
  values:
  - 22
- tag: PASSWORD TYPE
  values:
  - value: password
- tag: DNS LABEL
  values:
  - value: ',"dnsLabel":{"value":"<RESOURCE GROUP>"}'
- tag: STACK PARAM
  values:
  - value: ',"mgmtSubnetName":{"value":"mgmt"},"mgmtIpAddress":{"value":"192.168.1.4"}<SUBNET PARAM>'
    when:
      tag: CLUSTER
      values:
      - No
  - value: ',"mgmtSubnetName":{"value":"mgmt"},"mgmtIpAddressRangeStart":{"value":"192.168.1.4"}<SUBNET PARAM>'
    when:
      tag: CLUSTER
      values:
      - Yes
- tag: STACK TYPE
  values:
  - value: existing-stack
- tag: SUBNET PARAM
  values:
  - value: ',"internalSubnetName":{"value":"internal"},"internalIpAddressRangeStart":{"value":"192.168.2.4"}'
- tag: SUBNET PARAM SELF
  values:
  - value: ',"internalIpSelfAddressRangeStart":{"value":"192.168.2.10"}'
- tag: BASE VLAN NAME
  values:
  - value: 'internal'
- tag: NUMBER OF ADDITIONAL NICS
  values:
  - value: 0
    requires:
      tag: NIC COUNT
      values:
      - 1
      - 2
- tag: ADDITIONAL NIC LOCATION
  values:
  - value: internal2
    when:
      tag: NUMBER OF ADDITIONAL NICS
      values:
      - 1
  - value: internal2;internal3
    when:
      tag: NUMBER OF ADDITIONAL NICS
      values:
      - 2
  - value: internal2;internal3;internal4
    when:
      tag: NUMBER OF ADDITIONAL NICS
      values:
      - 3
  - value: internal2;internal3;internal4;internal5
    when:
      tag: NUMBER OF ADDITIONAL NICS
      values:
      - 4
  - value: internal2;internal3;internal4;internal5;internal6
    when:
      tag: NUMBER OF ADDITIONAL NICS
      values:
      - 5
- tag: ADDTL NIC PARAM
  values:
  - value: ',"numberOfAdditionalNics":{"value":<NUMBER OF ADDITIONAL NICS>},"additionalNicLocation":{"value":"<ADDITIONAL NIC LOCATION>"}'
    when:
      tag: NIC COUNT
      values:
      - 4
- tag: TEMPLATE URL
  values:
  - https://raw.githubusercontent.com/F5Networks/f5-azure-arm-templates/<BRANCH>/experimental/bigiq/licenseManagement/<CLUSTER FOLDER>/<NIC COUNT>nic/existing-stack/<LICENSE TYPE>/azuredeploy.json
  - https://gitlab.f5net.com/cloudsolutions/f5-cloud-factory/raw/<BRANCH>/f5-azure-arm-templates/experimental/bigiq/licenseManagement/<CLUSTER FOLDER>/<NIC COUNT>nic/existing-stack/<LICENSE TYPE>/azuredeploy.json
- tag: TIMEZONE
  values:
  - UTC
- tag: USAGE ANALYTICS CHOICE
  values:
  - No
  - Yes
- tag: VNET PARAM
  values:
  - value: ',"vnetName":{"value":"existingStackVnet"},"vnetResourceGroupName":{"value":"<RESOURCE GROUP>"},"masterKey":{"value":"Pass1word!Pass1word!"}'
- tag: CLUSTER
  values:
  - No
  - Yes
- tag: CLUSTER FOLDER
  values:
  - value: cluster
    when:
      tag: CLUSTER
      values:
      - Yes
  - value: standalone
    when:
      tag: CLUSTER
      values:
      - No
- tag: SEQUENCE NUMBER
  values:
  - 0
- tag: SOLUTION LOGS
  values:
  - value: 'install.log;onboard.log;network.log'
